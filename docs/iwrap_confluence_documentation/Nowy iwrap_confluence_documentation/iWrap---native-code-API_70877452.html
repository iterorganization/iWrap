<!DOCTYPE html>
<html>
    <head>
        <title>Scientific Worfklows : iWrap - native code API</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Scientific Worfklows</a></span>
                            </li>
                                                    <li>
                                <span><a href="Wrapping-user-codes-into-actors---iWrap_70877391.html">Wrapping user codes into actors - iWrap</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Scientific Worfklows : iWrap - native code API
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Bartosz Palak</span>, last modified on 23 Nov 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type="text/css">/*<![CDATA[*/
div.rbtoc1637660171282 {padding: 0px;}
div.rbtoc1637660171282 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1637660171282 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1637660171282">
<ul class="toc-indentation">
<li><a href="#iWrapnativecodeAPI-Introduction">1. Introduction</a></li>
<li><a href="#iWrapnativecodeAPI-ThemethodAPI">2. The method API</a>
<ul class="toc-indentation">
<li><a href="#iWrapnativecodeAPI-Initialisationmethod">2.1. Initialisation&#xa0;method</a></li>
<li><a href="#iWrapnativecodeAPI-Mainmethod">2.2. Main method</a></li>
<li><a href="#iWrapnativecodeAPI-Finalizemethod">2.3. Finalize method</a></li>
</ul>
</li>
<li><a href="#iWrapnativecodeAPI-APIimplementation">3. API implementation</a>
<ul class="toc-indentation">
<li><a href="#iWrapnativecodeAPI-Fortran">3.1. Fortran</a>
<ul class="toc-indentation">
<li><a href="#iWrapnativecodeAPI-Nativecodesignature">3.1.1. Native code signature</a></li>
<li><a href="#iWrapnativecodeAPI-Module">3.1.2. Module</a></li>
<li><a href="#iWrapnativecodeAPI-Subroutines">3.1.3. Subroutines</a></li>
<li><a href="#iWrapnativecodeAPI-Arguments">3.1.4. Arguments</a></li>
</ul>
</li>
<li><a href="#iWrapnativecodeAPI-Example">3.2. Example</a></li>
<li><a href="#iWrapnativecodeAPI-C++">3.3. &#xa0;C++</a>
<ul class="toc-indentation">
<li><a href="#iWrapnativecodeAPI-Nativecodesignature.1">3.3.1. Native code signature</a></li>
<li><a href="#iWrapnativecodeAPI-Header">3.3.2. Header</a></li>
<li><a href="#iWrapnativecodeAPI-Method">3.3.3. Method</a></li>
<li><a href="#iWrapnativecodeAPI-Arguments.1">3.3.4. Arguments</a></li>
<li><a href="#iWrapnativecodeAPI-Example.1">3.3.5. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#iWrapnativecodeAPI-MPI">4. MPI</a></li>
<li><a href="#iWrapnativecodeAPI-Codepackaging">5. Code packaging</a></li>
</ul>
</div><p></p><h1 id="iWrapnativecodeAPI-Introduction"><span class="nh-number">1. </span>Introduction</h1><div class="confluence-information-macro confluence-information-macro-warning"><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><span style="color: rgb(23,43,77);">A signature of user code must follow strict rules to be wrapped by iWrap - without the detailed knowledge of method signature iWrap cannot built an actor.</span></p></div></div><p><br></p><p><span style="color: rgb(23,43,77);">iWrap actor calls three methods of the native code:</span></p><ul><li>The initialisation&#xa0;method</li><li><span style="color: rgb(23,43,77);">The main ("step") method</span></li><li>The finalisation&#xa0;method</li></ul><p>Signatures of methods may differ, depending of features of programming language being used, however the main principia remains&#xa0;the same.&#xa0;</p><h1 id="iWrapnativecodeAPI-ThemethodAPI"><span class="nh-number">2. </span>The method API</h1><h2 id="iWrapnativecodeAPI-Initialisationmethod"><span class="nh-number">2.1. </span>Initialisation<span style="color: rgb(23,43,77);">&#xa0;method</span></h2><p><span style="color: rgb(23,43,77);">

<map id="gliffy-map-77370372-7833" name="gliffy-map-77370372-7833"></map>
</span></p><table width="100%" class="gliffy-macro-table">
    <tbody><tr>
        <td>
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
                                    </caption>
                <tbody><tr>
                    <td>
                        <img style="border: none; width: 562px;" usemap="#gliffy-map-77370372-7833" src="attachments/70877452/77370373.png" alt="" class="gliffy-macro-image">
                    </td>
                </tr>
            </tbody></table>
        </td>
    </tr>
</tbody></table>


<p></p><ul><li>An optional method used for set-up of native code</li><li><span style="color: rgb(23,43,77);">If provided - the method is called only, when an actor is </span>initialised - The method must be run <strong>before</strong> a call of <em>main</em> and <em>finalisation&#xa0;</em>(if provided)</li><li>The method can be of arbitrary name (the name has to be specified in the code YAML description)</li><li>Method arguments:<ul><li>Code parameters:<ul><li><strong>Optional</strong><span>&#xa0;</span>argument</li><li>Type: string</li><li>Intent: IN</li></ul></li></ul></li></ul><ul><li style="list-style-type: none;"><ul><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Type: Integer</li><li>Intent: OUT</li></ul></li></ul></li></ul><ul><li style="list-style-type: none;"><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Type: string</li><li>Intent: OUT</li></ul></li></ul></li></ul><p><br></p><h2 id="iWrapnativecodeAPI-Mainmethod"><span class="nh-number">2.2. </span><span style="color: rgb(23,43,77);">Main method</span></h2><p>

<map id="gliffy-map-70877458-650" name="gliffy-map-70877458-650"></map>
</p><table width="100%" class="gliffy-macro-table">
    <tbody><tr>
        <td>
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
                                    </caption>
                <tbody><tr>
                    <td>
                        <img style="border: none; width: 556px;" usemap="#gliffy-map-70877458-650" src="attachments/70877452/70877459.png" alt="" class="gliffy-macro-image">
                    </td>
                </tr>
            </tbody></table>
        </td>
    </tr>
</tbody></table>


<p></p><ul><li>A <strong>mandatory</strong> method that native code <strong>must</strong> provide</li><li><span style="color: rgb(23,43,77);">The method can be run an arbitrary numer of times (e.g. in a loop)</span></li><li>It can be of arbitrary name (the name has to be specified in the code YAML description)</li><li>The method must be run <strong>after</strong> a call of <em>initialisation</em>&#xa0;(if provided) and <strong>before</strong> a call of&#xa0;<em>finalisation&#xa0;</em>(if provided)</li><li>Method arguments:<ul><li>Input and output IDSes:<ul><li><strong>Optional</strong><span>&#xa0;</span>arguments</li><li>Intent: IN or OUT</li></ul></li><li>XML parameters:<ul><li><strong>Optional</strong><span>&#xa0;</span>argument</li><li>Intent: IN</li></ul></li><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Type: Integer</li><li>Intent: OUT</li></ul></li></ul></li></ul><ul><li style="list-style-type: none;"><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Type: string</li><li>Intent: OUT</li></ul></li></ul></li></ul><h2 id="iWrapnativecodeAPI-Finalizemethod"><span class="nh-number">2.3. </span>Finalize method</h2><p>

<map id="gliffy-map-77370388-5490" name="gliffy-map-77370388-5490"></map>
</p><table width="100%" class="gliffy-macro-table">
    <tbody><tr>
        <td>
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
                                    </caption>
                <tbody><tr>
                    <td>
                        <img style="border: none; width: 552px;" usemap="#gliffy-map-77370388-5490" src="attachments/70877452/77370389.png" alt="" class="gliffy-macro-image">
                    </td>
                </tr>
            </tbody></table>
        </td>
    </tr>
</tbody></table>


<p></p><p><br></p><ul><li>An optional method that is usually called to clean-up environment</li><li><span style="color: rgb(23,43,77);">The method can be run an arbitrary numer of times</span></li><li>The method can be of arbitrary name (the name has to be specified in the code YAML description)</li><li>Method arguments:<ul><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Type: Integer</li><li>Intent: OUT</li></ul></li></ul></li></ul><ul><li style="list-style-type: none;"><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Type: string</li><li>Intent: OUT</li></ul></li></ul></li></ul><p><br></p><div class="confluence-information-macro confluence-information-macro-warning"><p class="title">Important!</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>A native code wrapped by iWrap that will become a part of workflow should be compiled using the same environment in which workflow will be run!</p></div></div><p><br></p><h1 id="iWrapnativecodeAPI-APIimplementation"><span class="nh-number">3. </span>API implementation</h1><h2 id="iWrapnativecodeAPI-Fortran"><span class="nh-number">3.1. </span>Fortran</h2><h3 id="iWrapnativecodeAPI-Nativecodesignature"><span class="nh-number">3.1.1. </span>Native code signature</h3><p><br></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module &lt;module name&gt;
 
!
!    INITIALISATION SUBROUTINE
!
  subroutine &lt;init subroutine name&gt; ([xml_parameters,] status_code, status_message)
&#xa0;&#xa0;use ids_schemas
 &#xa0;
&#xa0;&#xa0;! XML code parameters
&#xa0;&#xa0;type(ids_parameters_input) :: xml_parameters
&#xa0;
&#xa0;&#xa0;! status info
&#xa0;&#xa0;integer, intent(OUT) :: status_code
&#xa0;&#xa0;character(len=:), pointer, intent(OUT) :: status_message
&#xa0;
end subroutine &lt;init subroutine name&gt; 

subroutine &lt;subroutine name&gt; ([ids1, ids2, ..., idsN,] [xml_parameters], status_code, status_message)
&#xa0;&#xa0;use ids_schemas
&#xa0;&#xa0;! IN/OUT IDSes
&#xa0;&#xa0;type(ids_&lt;ids_name&gt;), intent([IN|OUT]):: ids1
&#xa0;&#xa0;type(ids_&lt;ids_name&gt;), intent([IN|OUT]):: ids2
&#xa0;&#xa0;&#xa0;. . .
&#xa0;&#xa0;type(ids_&lt;ids_name&gt;), intent([IN|OUT]):: idsN&#xa0;
&#xa0;
&#xa0;&#xa0;! XML code parameters
&#xa0;&#xa0;type(ids_parameters_input) :: xml_parameters
&#xa0;
&#xa0;&#xa0;! status info
&#xa0;&#xa0;integer, intent(OUT) :: status_code
&#xa0;&#xa0;character(len=:), pointer, intent(OUT) :: status_message
&#xa0;
end subroutine &lt;subroutine name&gt;

!
!    FINALISATION SUBROUTINE
!
subroutine &lt;finish subroutine name&gt; (status_code, status_message)
 &#xa0;use ids_schemas
&#xa0;
&#xa0;&#xa0;! status info
&#xa0;&#xa0;integer, intent(OUT) :: status_code
&#xa0;&#xa0;character(len=:), pointer, intent(OUT) :: status_message
&#xa0;
end subroutine &lt;finish subroutine name&gt;   
end module &lt;module name&gt;</pre>
</div></div><p><br></p><h3 id="iWrapnativecodeAPI-Module"><span class="nh-number">3.1.2. </span>Module</h3><ul><li>Native code should be put within a module</li><li>Module is used by compiler to check, if code signature expected by wrapper is exactly the same as provided.</li><li>A name of the module could be arbitrary - chosen by code developer</li></ul><h3 id="iWrapnativecodeAPI-Subroutines"><span class="nh-number">3.1.3. </span>Subroutines</h3><ul><li>A user code should be provided as subroutines (and not a functions)</li><li>A name of subroutines could be arbitrary - chosen by code developer</li><li>A name of the module could be arbitrary - chosen by code developer</li><li>Arguments shall be provided in a strict order</li><li>No INOUT arguments are allowed!</li></ul><h3 id="iWrapnativecodeAPI-Arguments"><span class="nh-number">3.1.4. </span>Arguments</h3><p><em>Initialisation subroutine:</em></p><ul><li>XML parameters:<ul><li><strong>Optional</strong><span>&#xa0;</span>argument</li><li>Intent: IN</li><li>Defined as "<code>type(ids_parameters_input), intent(IN)"</code>&#xa0;</li></ul></li><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Intent: OUT</li><li>Defined as&#xa0; "<code>integer, intent(OUT)"</code><span>&#xa0;</span></li></ul></li></ul><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Intent: OUT</li><li>Defined as:<span>&#xa0;</span><code>character(len=:), pointer, intent(OUT)</code>&#xa0;</li></ul></li></ul><p><em>Main subroutine:</em></p><ul><li>Input and output IDSes:<ul><li><strong>Optional</strong><span>&#xa0;</span>arguments</li><li>Intent: IN or OUT</li><li>Defined as "<code>type(ids_&lt;ids_name&gt;)</code><span>&#xa0;</span>"</li></ul></li><li>XML parameters:<ul><li><strong>Optional</strong><span>&#xa0;</span>argument</li><li>Intent: IN</li><li>Defined as "<code>type(ids_parameters_input), intent(IN)"</code>&#xa0;</li></ul></li><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Intent: OUT</li><li>Defined as&#xa0; "<code>integer, intent(OUT)"</code><span>&#xa0;</span></li></ul></li></ul><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Intent: OUT</li><li>Defined as:<span>&#xa0;</span><code>character(len=:), pointer, intent(OUT)</code>&#xa0;</li></ul></li></ul><p><em>Finalisation subroutine:</em></p><ul><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Intent: OUT</li><li>Defined as&#xa0; "<code>integer, intent(OUT)"</code><span>&#xa0;</span></li></ul></li></ul><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Intent: OUT</li><li>Defined as:<span>&#xa0;</span><code>character(len=:), pointer, intent(OUT)</code>&#xa0;</li></ul></li></ul><h2 id="iWrapnativecodeAPI-Example"><span class="nh-number">3.2. </span>Example</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module physics_ii_mod
&#xa0;&#xa0;
    !
    !    INITIALISATION SUBROUTINE
    !
subroutine init_code (xml_parameters, status_code, status_message)
    use ids_schemas, only: ids_parameters_input
    implicit none
    type(ids_parameters_input) :: xml_parameters
    integer, intent(out) :: status_code
    character(len=:), pointer, intent(out) :: status_message

    ! Setting status to SUCCESS
    status_code = 0
    allocate(character(50):: status_message)
    status_message = 'OK'

    write(*,*) '============ The subroutine body ============='

end subroutine init_code

    !
    !    MAIN SUBROUTINE
    ! 

subroutine physics_ii(equilibrium_in, equilibrium_out, code_param, error_flag, error_message) &#xa0; &#xa0;&#xa0;&#xa0;

  use ids_schemas &#xa0; 

  ! IN/OUT IDSes
&#xa0;&#xa0;type(ids_equilibrium):: equilibrium_in, equilibrium_out
&#xa0;
&#xa0;&#xa0;! XML code parameters
&#xa0;&#xa0;type(ids_parameters_input) :: code_param
&#xa0;
&#xa0;&#xa0;! status info
&#xa0;&#xa0;integer, intent(out) :: error_flag
&#xa0;&#xa0;character(len=:), pointer, intent(out) :: error_message
&#xa0;
end subroutine physics_ii

    !
    !    FINALISATION SUBROUTINE
    !
subroutine clean_up(status_code, status_message)
    implicit none
    integer, intent(out) :: status_code
    character(len=:), pointer, intent(out) :: status_message

    ! Setting status to SUCCESS
    status_code = 0
    allocate(character(50):: status_message)
    status_message = 'OK'

    write(*,*) '============ The subroutine body =============' 

end subroutine clean_up


end module physics_ii_mod</pre>
</div></div><h2 id="iWrapnativecodeAPI-C++"><span class="nh-number">3.3. </span>&#xa0;C++</h2><h3 id="iWrapnativecodeAPI-Nativecodesignature.1"><span class="nh-number">3.3.1. </span>Native code signature</h3><p><br></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#include "UALClasses.h"

/* * * Initialisation method * * */
void &lt;method name&gt;([IdsNs::codeparam_t codeparam,] int* status_code, char** status_message)

/* * * Main method * * */
void &lt;method name&gt;([IdsNs::IDS::&lt;ids_name&gt; ids1, ..., IdsNs::IDS::&lt;ids_name&gt;&amp; idsN,] [IdsNs::codeparam_t codeparam,] int* status_code, char** status_message)

/* * * Finalisation method * * */
void &lt;method name&gt;(int* status_code, char** status_message)</pre>
</div></div><h3 id="iWrapnativecodeAPI-Header"><span class="nh-number">3.3.2. </span>Header</h3><p>To generate an actor user has to provide a file containing C++ header of wrapped method. This file can be of arbitrary name but must contain method signature.</p><h3 id="iWrapnativecodeAPI-Method"><span class="nh-number">3.3.3. </span>Method</h3><ul><li>A user code should be provided as methods (and not a functions)</li><li>A name of methods could be arbitrary - chosen by code developer</li><li>Arguments shall be provided in a strict order</li><li>No INOUT arguments are allowed!</li></ul><h3 id="iWrapnativecodeAPI-Arguments.1"><span class="nh-number">3.3.4. </span>Arguments</h3><p>Arguments shall be provided in a strict order:</p><ul><li>Input IDSes:<ul><li><strong>Optional</strong><span>&#xa0;</span>arguments</li><li>Defined as <code>"IdsNs::IDS::&lt;ids_name&gt;"</code>&#xa0;</li></ul></li><li>Output IDSes:<ul><li><strong>Optional</strong><span>&#xa0;</span>arguments</li><li>Defined as <code>IdsNs::IDS::&lt;ids_name&gt;&amp;</code>&#xa0;&#xa0;(please notice reference sign - '&amp;')</li></ul></li><li>XML parameters:<ul><li><strong>Optional</strong><span>&#xa0;</span>argument</li><li>Input argument</li><li>Defined as <code>"IdsNs::codeparam_t</code> "&#xa0;</li></ul></li><li>Status code:<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Output argument</li><li>Defined as &#xa0;<code>"int*"</code>&#xa0;<span>&#xa0;</span></li></ul></li></ul><ul><li>Status message<ul><li><strong>Mandatory</strong><span>&#xa0;</span>argument</li><li>Output argument</li><li>Defined as:<span> "<code>char**</code> "</span></li></ul></li></ul><p>No INOUT arguments are allowed!</p><h3 id="iWrapnativecodeAPI-Example.1"><span class="nh-number">3.3.5. </span>Example</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Header file - physics_ii.h</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: Confluence" data-theme="Confluence">#ifndef _LEVEL_II_CPP
#define _LEVEL_II_CPP

#include "UALClasses.h" 

/* * *   INITIALISATION method   * * */ 
void init_code (IdsNs::codeparam_t codeparam, int* status_code, char** status_message);

/* * *   MAIN method   * * */  
void physics_ii_cpp(IdsNs::IDS::equilibrium in_equilibrium, IdsNs::IDS::equilibrium&amp; out_equilibrium, IdsNs::codeparam_t codeparam, int* status_code, char** status_message);

/* * *   FINALISATION method   * * */ 
void clean_up(int* status_code, char** status_message);


#endif // _LEVEL_II_CPP</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Implementation file - level_ii.cpp</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: Confluence" data-theme="Confluence">#include "UALClasses.h" 

/* * *   INITIALISATION method   * * */ 
void init_code (IdsNs::codeparam_t codeparam, int* status_code, char** status_message)
{
...
// method body
...
}

/* * *   MAIN method   * * */  
void physics_ii_cpp(IdsNs::IDS::equilibrium in_equilibrium, IdsNs::IDS::equilibrium&amp; out_equilibrium, IdsNs::codeparam_t codeparam, int* status_code, char** status_message)
{
...
// method body
...
}

/* * *   FINALISATION method   * * */ 
void clean_up(int* status_code, char** status_message)
{
...
// method body
...
}</pre>
</div></div><h1 id="iWrapnativecodeAPI-MPI"><span class="nh-number">4. </span>MPI</h1><p>All native codes that use MPI should follow the rules described below:</p><ul><li>Please make initialisation and finalisation conditional, checking if such action was already made.</li></ul><div class="table-wrap"><table class="wrapped confluenceTable" style="text-align: left;"><colgroup><col></colgroup><tbody style="text-align: left;"><tr style="text-align: left;"><td style="text-align: left;" class="confluenceTd"><p style="text-align: left;"><code class="sql plain" style="text-align: left;">!</code><code class="sql comments" style="text-align: left;">----&#xa0; MPI initialisation ----</code><br><code class="sql plain" style="text-align: left;">call MPI_initiazed(was_mpi_initialized, ierr)</code><br><code class="sql plain" style="text-align: left;">if (.</code><code class="sql color1" style="text-align: left;">not</code><code class="sql plain" style="text-align: left;">. was_mpi_initialized)&#xa0;&#xa0; call MPI_Init(ierr)</code><br>&#xa0;<br><code class="sql plain" style="text-align: left;">!</code><code class="sql comments" style="text-align: left;">----&#xa0; MPI Finalisation ----</code><br><code class="sql plain" style="text-align: left;">call MPI_finalized(was_mpi_finalized, ierr)</code><br><code class="sql plain" style="text-align: left;">if (.</code><code class="sql color1" style="text-align: left;">not</code><code class="sql plain" style="text-align: left;">. was_mpi_finalized)&#xa0;&#xa0; call MPI_Finalize(ierr)</code></p></td></tr></tbody></table></div><p><br></p><ul><li>Please b<span style="color: rgb(0,0,0);">e aware of a special role of ranked 0 process: Wrapper that run native code,&#xa0; launched in parallel, reads input data in every processes but writes it only in 'rank 0' process. So native code should gather all results that need to be stored by 'rank 0' process. It concerns also<span>&#xa0;</span></span>those coming from 'rank 0' process are analysed by wrapper.</li></ul><h1 id="iWrapnativecodeAPI-Codepackaging"><span class="nh-number">5. </span>Code packaging</h1><p>A native code written in C++ or Fortran should be packed within static Linux library using e.g. <code>ar</code> tool for that purpose.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ar -cr lib&lt;name&gt;.a &lt;object files *.o list&gt;
e.g.:
ar -cr libphysics_ii.a *.o</pre>
</div></div><p><br></p><p><br></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/70877460">iWrapNativeCodeAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/70877461.png">iWrapNativeCodeAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/70877462">iWrapNativeCodeAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/70877463.png">iWrapNativeCodeAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370369">iWrapNativeCodeAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370370.png">iWrapNativeCodeAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370385">iWrapNativeCodeAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370386.png">iWrapNativeCodeAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370375">iWrapInitializationMethodAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370376.png">iWrapInitializationMethodAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370372">iWrapInitializationMethodAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370373.png">iWrapInitializationMethodAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/70877458">iWrapNativeCodeAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/70877459.png">iWrapNativeCodeAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370396">iWrapNativeCodeFinishAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370397.png">iWrapNativeCodeFinishAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370400">iWrapNativeCodeFinishAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370401.png">iWrapNativeCodeFinishAPI.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370388">iWrapNativeCodeFinishAPI</a> (application/gliffy+json)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/70877452/77370389.png">iWrapNativeCodeFinishAPI.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on 23 Nov 2021 10:36</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
